<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Glacat</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link href="../../static/img/favicon.png" rel="icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700"/>
    <link rel="stylesheet" href="../../static/fonts/icomoon/style.css"/>

    <!--    thư viện của bảng tích hợp tìm kiếm-->
    <link rel='stylesheet' href='https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css'>
    <!--    thư viện của bảng tích hợp tìm kiếm end-->

    <link rel="stylesheet" href="../../static/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../static/css/magnific-popup.css"/>
    <link rel="stylesheet" href="../../static/css/jquery-ui.css"/>
    <link rel="stylesheet" href="../../static/css/owl.carousel.min.css"/>
    <link rel="stylesheet" href="../../static/css/owl.theme.default.min.css"/>

    <link rel="stylesheet" href="../../static/css/aos.css"/>

    <link rel="stylesheet" href="../../static/css/style-customer-template.css"/>
</head>

<body>
<div class="site-wrap">
    <header class="site-navbar" role="banner">
        <div class="site-navbar-top">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-6 col-md-4 order-2 order-md-1 site-search-icon text-left">
                        <form action="" class="site-block-top-search">
                            <span class="icon icon-search2"></span>
                            <input type="text" class="form-control border-0" placeholder="Search"/>
                        </form>
                    </div>

                    <div class="col-12 mb-3 mb-md-0 col-md-4 order-1 order-md-2 text-center">
                        <div class="site-logo">
                            <a href="/home" class="js-logo-clone">Glacat</a>
                        </div>
                    </div>

                    <div class="col-6 col-md-4 order-3 order-md-3 text-right">
                        <div class="site-top-icons">
                            <ul>
                                <li>
                                    <a href="#"><span class="icon icon-person"></span></a>
                                </li>
                                <li>
                                    <a href="#"><span class="icon icon-heart-o"></span></a>
                                </li>
                                <li>
                                    <a href="/cart" class="site-cart">
                                        <span class="icon icon-shopping_cart"></span>
                                        <span class="count">2</span>
                                    </a>
                                </li>
                                <li class="d-inline-block d-md-none ml-md-0">
                                    <a href="#" class="site-menu-toggle js-menu-toggle"><span
                                            class="icon-menu"></span></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <nav class="site-navigation text-right text-md-center" role="navigation">
            <div class="container">
                <ul class="site-menu js-clone-nav d-none d-md-block">
                    <li>
                        <a href="/home">Trang chủ</a>
                        <!-- <ul class="dropdown">
                    <li><a href="#">Menu One</a></li>
                    <li><a href="#">Menu Two</a></li>
                    <li><a href="#">Menu Three</a></li>
                    <li class="has-children">
                      <a href="#">Sub Menu</a>
                      <ul class="dropdown">
                        <li><a href="#">Menu One</a></li>
                        <li><a href="#">Menu Two</a></li>
                        <li><a href="#">Menu Three</a></li>
                      </ul>
                    </li>
                  </ul> -->
                    </li>
                    <!-- <li>
                  <a href="about.html">Về chúng tôi</a>
                  <ul class="dropdown">
                  <li><a href="#">Menu One</a></li>
                  <li><a href="#">Menu Two</a></li>
                  <li><a href="#">Menu Three</a></li>
                </ul>
                </li> -->
                    <li><a href="/shop">Sản phẩm</a></li>
                    <li><a href="contact.html">Liên hệ</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="bg-light py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 mb-0">
                    <a href="/home">Home</a> <span class="mx-2 mb-0">/</span>
                    <a href="/cart">Cart</a> <span class="mx-2 mb-0">/</span>
                    <strong class="text-black">Checkout</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="site-section">
        <div class="container" style="max-width: 90%">
            <div class="row mb-3">
                <form class="col-md-12" method="post">
                    <div class="site-blocks-table">
                        <!--                        <table class="table table-bordered">-->
                        <table id="myTable" class="table">
                            <thead>
                            <tr>
                                <th class="product-thumbnail">Ảnh</th>
                                <th class="product-name">Sản Phẩm</th>
                                <th class="product-name">Phân Loại</th>
                                <th class="product-quantity">Đơn Giá</th>
                                <th class="product-quantity">Số Lượng</th>
                                <th class="product-quantity">Thành Tiền</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="gioHangCT : ${listGioHangChiTiet}">
                                <td class="product-thumbnail">
                                    <input type="hidden" name="allIDGioHangCT" th:value="${gioHangCT.id}">
                                    <img th:src="@{'../../../static/img/' + ${gioHangCT.chiTietSanPham.sanPham.listHinhAnhSanPham[0].url}}"
                                         alt="Image" class="img-fluid"/>
                                </td>
                                <td class="product-name">
                                    <h2 class="h5 text-black" th:text="${gioHangCT.chiTietSanPham.sanPham.ten}"></h2>
                                </td>
                                <td class="product-name">
                                    <p>Kích Thước:
                                        <span th:text="${gioHangCT.chiTietSanPham.kichCo.ten}"></span>
                                    </p>
                                    <p>Màu Sắc:
                                        <span th:text="${gioHangCT.chiTietSanPham.mauSac.ten}"></span>
                                    </p>
                                    <p>Loại Đế:
                                        <span th:text="${gioHangCT.chiTietSanPham.loaiDe.ten}"></span>
                                    </p>

                                </td>
                                <td th:text="${gioHangCT.chiTietSanPham.giaHienHanh + ' VNĐ'}"></td>

                                <td th:text="${gioHangCT.soLuong}">
                                </td>

                                <td th:text="${gioHangCT.tongTien() + ' VNĐ'}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>
            <div class="row">
                <div class="col-md-7 mb-5 mb-md-0">
                    <h2 class="h3 mb-3 text-black">Thông tin của bạn</h2>
                    <div th:if="${checkDiaChi=='DiaChi'}">
                        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
                        <table class="table p-3 p-lg-5 border">
                            <h5>Địa chỉ giao hàng</h5>
                            <thead>
                            <tr>
                                <th>Chọn</th>
                                <th colspan="4" style="text-align: center">Địa Chỉ Cụ Thể</th>
                                <th>Thao Tác</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="diaChi, status : ${listDiaChi}" class="diaChiRow">
                                <td>
                                    <input type="radio" id="defaultRadio" name="chonDiaChi"
                                           th:data-index="${status.index}"
                                           onchange="handleRadioChange(this)">
                                </td>
                                <td th:text="${diaChi.diaChiCuThe}"></td>
                                <td th:id="${diaChi.phuongXa}" class="phuongXaColumn"></td>
                                <td th:id="${diaChi.quanHuyen}" class="quanHuyenColumn"></td>
                                <td class="thanhPhoColumn"></td>
                                <td>
                                    <button type="button" class="btn btn-success">Sửa</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                // Chọn radio button có ID là "defaultRadio" và gọi sự kiện onchange
                                var defaultRadio = document.getElementById('defaultRadio');
                                if (defaultRadio) {
                                    defaultRadio.checked = true;
                                    setTimeout(function () {
                                        defaultRadio.dispatchEvent(new Event('change'));
                                    }, 500); // Trì hoãn 1000 miligiây (1 giây)
                                }
                            });

                            function handleRadioChange(rowIndex) {
                                var index = rowIndex.getAttribute('data-index');
                                var selectedRow = $('.diaChiRow:eq(' + index + ')');

                                // Sử dụng .attr() để lấy giá trị thuộc tính id
                                var phuongXaId = selectedRow.find('.phuongXaColumn').attr('id');
                                var quanHuyenId = selectedRow.find('.quanHuyenColumn').attr('id');
                                console.log(phuongXaId)
                                console.log(quanHuyenId)
                                var secondTdValue2 = selectedRow.find('td:nth-child(2)').text();
                                var secondTdValue3 = selectedRow.find('td:nth-child(3)').text();
                                var secondTdValue4 = selectedRow.find('td:nth-child(4)').text();
                                var secondTdValue5 = selectedRow.find('td:nth-child(5)').text();
                                var diaChi = document.getElementById("diaChiCuTheAll");
                                // console.log(secondTdValue2)
                                // console.log(secondTdValue3)
                                diaChi.value = secondTdValue2 + ', ' + secondTdValue3 + ', ' + secondTdValue4 + ', ' + secondTdValue5;
                                // Thực hiện các thao tác khác dựa trên giá trị của secondTdValue

                                const shippingInfo = {
                                    // weight: parseFloat(weight),
                                    service_type_id: 2,
                                    // from_district_id: 3440,
                                    to_district_id: Number(quanHuyenId),
                                    to_ward_code: phuongXaId,
                                    height: 30, //cao cm
                                    length: 30, //chieu dai cm
                                    weight: 1000, //can nang (g)
                                    width: 30, //rong cm
                                    insurance_value: 0,
                                    coupon: null,
                                    items: [
                                        {
                                            "name": "TEST1",
                                            "quantity": 1,
                                            "height": 20,
                                            "weight": 1,
                                            "length": 20,
                                            "width": 20
                                        }
                                    ]
                                };
                                console.log(shippingInfo)

                                fetch('https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/fee', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Token': '0c4a5894-7fc8-11ee-96dc-de6f804954c9', // Replace with your GHN API token
                                        // 'shop_id': 4689281
                                    },
                                    body: JSON.stringify(shippingInfo)
                                })
                                    .then(response => response.json())
                                    .then(data => {

                                        const shippingFeeResult = document.getElementById('shippingFeeResult');
                                        const tienShip = document.getElementById('tienShip');
                                        tienShip.value = `${data.data.total}`
                                        shippingFeeResult.innerHTML = `${data.data.total + ' VND'}`;

                                        //tổng tiền khi giảm
                                        var totalElementSale = document.getElementById("totalAmountAndSale");

                                        //tổng tiền khi giảm input
                                        var tongTienAndSale = document.getElementById("tongTienAndSale");

                                        //tổng tiền
                                        var tongTien = document.getElementById("tongTien");
                                        var tongTienInt = parseInt(tongTien.value);

                                        tongTienAndSale.value = `${data.data.total + tongTienInt}`;
                                        totalElementSale.innerHTML = `${data.data.total + tongTienInt + ' VND'}`;

                                        console.log(data)
                                    })
                                    .catch(error => console.error('Error:', error));
                            }
                        </script>
                        <script th:inline="javascript">

                            document.addEventListener('DOMContentLoaded', function () {
                                fetch('https://online-gateway.ghn.vn/shiip/public-api/master-data/province', {
                                    method: 'GET',
                                    headers: {
                                        'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                        'Content-Type': 'application/json',
                                    },
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Lấy giá trị id thành phố từ thymeleaf
                                        var idThanhPhoArray = /*[[ ${listDiaChi.![thanhPho] }]]*/ [];

                                        // Duyệt qua mỗi dòng trong bảng
                                        document.querySelectorAll('.diaChiRow').forEach((row, index) => {
                                            // Lấy id thành phố cho dòng hiện tại
                                            var idThanhPho = idThanhPhoArray[index];

                                            // Tìm thành phố trong data.data dựa trên id
                                            var thanhPho = data.data.find(city => city.ProvinceID == idThanhPho);

                                            // Đặt tên thành phố vào thẻ có class là thanhPhoColumn trong dòng hiện tại
                                            var thanhPhoColumn = row.querySelector('.thanhPhoColumn');
                                            if (thanhPhoColumn && thanhPho) {
                                                thanhPhoColumn.innerText = thanhPho.ProvinceName;
                                            }
                                        });
                                    })
                                    .catch(error => {
                                        console.error('Lỗi khi tải dữ liệu thành phố:', error);
                                    });

                                // Hàm để tải và populate quận/huyện
                                fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/district`, {
                                    method: 'GET',
                                    headers: {
                                        'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                        'Content-Type': 'application/json',
                                    },
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Lấy giá trị id thành phố từ thymeleaf
                                        var idQuanHuyenArray = /*[[ ${listDiaChi.![quanHuyen] }]]*/ [];
                                        // Duyệt qua mỗi dòng trong bảng
                                        document.querySelectorAll('.diaChiRow').forEach((row, index) => {
                                            // Lấy id thành phố cho dòng hiện tại
                                            var idQuanHuyen = idQuanHuyenArray[index];

                                            // Tìm thành phố trong data.data dựa trên id
                                            var quanHuyen = data.data.find(district => district.DistrictID == idQuanHuyen);

                                            // Đặt tên thành phố vào thẻ có class là quanHuyenColumn trong dòng hiện tại
                                            var quanHuyenColumn = row.querySelector('.quanHuyenColumn');
                                            if (quanHuyenColumn && quanHuyen) {
                                                quanHuyenColumn.innerText = quanHuyen.DistrictName;
                                            }
                                        });
                                    })
                                    .catch(error => {
                                        console.error('Lỗi khi tải dữ liệu quận:', error);
                                    });


                                // Lấy danh sách id quận/huyện từ một danh sách district
                                var idQuanHuyenArray = /*[[ ${listDiaChi.![quanHuyen] }]]*/ [];

                                // Lặp qua từng id quận/huyện và gọi API cho mỗi id
                                idQuanHuyenArray.forEach(idQuanHuyen => {
                                    fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${idQuanHuyen}`, {
                                        method: 'GET',
                                        headers: {
                                            'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                            'Content-Type': 'application/json',
                                        },
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            // Lấy giá trị id thành phố từ thymeleaf
                                            var idPhuongXaArray = /*[[ ${khachHang.lstDiaChi.![phuongXa] }]]*/ [];
                                            // Duyệt qua mỗi dòng trong bảng
                                            document.querySelectorAll('.diaChiRow').forEach((row, index) => {
                                                // Lấy id thành phố cho dòng hiện tại
                                                var idPhuongXa = idPhuongXaArray[index];

                                                // Tìm thành phố trong data.data dựa trên id
                                                var phuongXa = data.data.find(ward => ward.WardCode == idPhuongXa);

                                                // Đặt tên thành phố vào thẻ có class là phuongXaColumn trong dòng hiện tại
                                                var phuongXaColumn = row.querySelector('.phuongXaColumn');
                                                if (phuongXaColumn && phuongXa) {
                                                    phuongXaColumn.innerText = phuongXa.WardName;
                                                }
                                            });
                                        })
                                        .catch(error => {
                                            console.error('Lỗi khi tải dữ liệu xã:', error);
                                        });
                                });
                            });

                        </script>
                        <form th:action="@{/checkout/add}" method="post" id="form1" class="p-3 p-lg-5 border">
                            <input type="text" name="idGioHangChiTiet" id="idGioHangChiTiet">
                            <input type="text" name="tongTien" id="tongTien">
                            <input type="text" name="tienShip" id="tienShip">
                            <input type="text" name="tongTienAndSale" id="tongTienAndSale">
                            <input type="text" th:value="${khachHang.email}" name="email">
                            <input type="text" th:value="1" name="voucher">

                            <div class="form-group row">
                                <div class="col-md-12">
                                    <label for="c_fname" class="text-black">
                                        <span class="text-danger">*</span>
                                        Họ và tên
                                    </label>
                                    <input type="text" class="form-control" id="c_fname" name="hoVaTen"
                                           placeholder="Họ và tên"
                                           th:value="${khachHang.hoVaTen}"/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-12">
                                    <label for="c_companyname" class="text-black">
                                        <span class="text-danger">*</span>
                                        Số điện thoại
                                    </label>
                                    <input type="text" class="form-control" id="c_companyname" name="soDienThoai"
                                           placeholder="Số điện thoại"
                                           th:value="${khachHang.soDienThoai}"/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-12">
                                    <label class="text-black">
                                        <span class="text-danger">*</span>
                                        Địa Chỉ
                                    </label>
                                    <input type="text" id="diaChiCuTheAll" readonly class="form-control"
                                           name="diaChiCuThe"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="c_order_notes" class="text-black">Ghi chú</label>
                                <textarea name="ghiChu" id="c_order_notes" cols="30" rows="5"
                                          class="form-control" placeholder="Viết ghi chú của bạn ở đây..."></textarea>
                            </div>

                        </form>
                    </div>
                    <div th:if="${checkDiaChi=='DiaChiNull'}">
                        <form th:action="@{/checkout/add}" method="post" id="form1" class="p-3 p-lg-5 border">
                            <input type="hidden" name="idGioHangChiTiet" id="idGioHangChiTiet">
                            <input type="hidden" name="tongTien" id="tongTien">
                            <input type="hidden" name="tongTienAndSale" id="tongTienAndSale">
                            <div class="form-group row">
                                <div class="col-md-12">
                                    <label for="c_fname" class="text-black">
                                        <span class="text-danger">*</span>
                                        Họ và tên
                                    </label>
                                    <input type="text" class="form-control" id="c_fname" name="hoVaTen"
                                           placeholder="Họ và tên"
                                           th:value="${khachHang.hoVaTen}"/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-12">
                                    <label for="c_companyname" class="text-black">
                                        <span class="text-danger">*</span>
                                        Số điện thoại
                                    </label>
                                    <input type="text" class="form-control" id="c_companyname" name="soDienThoai"
                                           placeholder="Số điện thoại"
                                           th:value="${khachHang.soDienThoai}"/>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-4">
                                    <label class="text-black">
                                        <span class="text-danger">*</span>
                                        Tỉnh/thành phố
                                    </label>
                                    <select id="citySelect" class="form-control" name="thanhPho">
                                        <option disabled selected>Chọn Thành Phố</option>
                                        <!-- Options will be filled dynamically here -->
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="text-black">
                                        <span class="text-danger">*</span>
                                        Quận/huyện
                                    </label>
                                    <select id="districtSelect" class="form-control" name="quanHuyen">
                                        <option value="" disabled selected>Chọn Quận Huyện</option>
                                        <!-- Options will be filled dynamically here -->
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="text-black">
                                        <span class="text-danger">*</span>
                                        Xã/phường
                                    </label>
                                    <select id="wardSelect" class="form-control" name="phuongXa"
                                            onchange="calculateShippingFee()">
                                        <option value="" disabled selected>Chọn Phường / Xã</option>
                                        <!-- Options will be filled dynamically here -->
                                    </select>
                                </div>

                                <script th:inline="javascript">
                                    document.addEventListener('DOMContentLoaded', function () {
                                        var citySelect = document.getElementById('citySelect');
                                        var districtSelect = document.getElementById('districtSelect');
                                        var wardSelect = document.getElementById('wardSelect');

                                        fetch('https://online-gateway.ghn.vn/shiip/public-api/master-data/province', {
                                            method: 'GET',
                                            headers: {
                                                'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                'Content-Type': 'application/json',
                                            },
                                        })
                                            .then(response => response.json())
                                            .then(data => {
                                                // Xử lý dữ liệu khi API trả về thành công
                                                populateSelect(citySelect, data.data, 'ProvinceID', 'ProvinceName');

                                                // Tìm option có giá trị là selectedCityValue và đặt nó làm được chọn
                                                var selectedOption = citySelect.querySelector(`option[value="${selectedCityValue}"]`);
                                                if (selectedOption) {
                                                    selectedOption.selected = true;
                                                    // Kiểm tra nếu giá trị thành phố đã được chọn
                                                    if (selectedCityValue) {
                                                        // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                        populateDistricts(selectedCityValue);
                                                    }
                                                }

                                            })
                                            .catch(error => {
                                                console.error('Lỗi khi tải dữ liệu thành phố:', error);
                                            });

                                        // Sự kiện khi chọn thành phố
                                        citySelect.addEventListener('change', function () {
                                            // Lấy ID của thành phố đã chọn
                                            var selectedCityId = this.value;

                                            console.log(selectedCityId);
                                            // Kiểm tra nếu giá trị thành phố đã được chọn
                                            if (selectedCityId) {
                                                // Xóa hết các quận/huyện hiện tại trước khi tải mới
                                                districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
                                                // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                populateDistricts(selectedCityId);
                                            }
                                        });

                                        // Sự kiện khi chọn quận
                                        districtSelect.addEventListener('change', function () {
                                            // Lấy ID của quận đã chọn
                                            var selectedDistrictId = this.value;

                                            console.log(selectedDistrictId);
                                            // Kiểm tra nếu giá trị quận đã được chọn
                                            if (selectedDistrictId) {
                                                // Xóa hết các quận/huyện hiện tại trước khi tải mới
                                                wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';
                                                // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                populateWard(selectedDistrictId);
                                            }
                                        });

                                        // Hàm để tải và populate quận/huyện
                                        function populateDistricts(selectedCityId) {
                                            fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/district?province_id=${selectedCityId}`, {
                                                method: 'GET',
                                                headers: {
                                                    'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    // Xử lý dữ liệu khi API trả về thành công
                                                    populateSelect(districtSelect, data.data, 'DistrictID', 'DistrictName');

                                                    // Tìm option có giá trị là selectedCityValue và đặt nó làm được chọn
                                                    var selectedOption = districtSelect.querySelector(`option[value="${selectedDistrictValue}"]`);
                                                    if (selectedOption) {
                                                        selectedOption.selected = true;
                                                        // Kiểm tra nếu giá trị thành phố đã được chọn
                                                        if (selectedDistrictValue) {
                                                            // Gọi hàm để tải và populate quận/huyện dựa trên ID của thành phố
                                                            populateWard(selectedDistrictValue);
                                                        }
                                                    }

                                                })
                                                .catch(error => {
                                                    console.error('Lỗi khi tải dữ liệu quận:', error);
                                                });
                                        }

                                        // Hàm để tải và populate xã phường
                                        function populateWard(selectedDistrictId) {
                                            fetch(`https://online-gateway.ghn.vn/shiip/public-api/master-data/ward?district_id=${selectedDistrictId}`, {
                                                method: 'GET',
                                                headers: {
                                                    'token': 'd900c67f-742d-11ee-96dc-de6f804954c9',
                                                    'Content-Type': 'application/json',
                                                },
                                            })
                                                .then(response => response.json())
                                                .then(data => {
                                                    // Xử lý dữ liệu khi API trả về thành công
                                                    populateSelect(wardSelect, data.data, 'WardCode', 'WardName');

                                                    // Tìm option có giá trị là selectedCityValue và đặt nó làm được chọn
                                                    var selectedOption = wardSelect.querySelector(`option[value="${selectedWardValue}"]`);
                                                    if (selectedOption) {
                                                        selectedOption.selected = true;
                                                    }

                                                })
                                                .catch(error => {
                                                    console.error('Lỗi khi tải dữ liệu xã:', error);
                                                });
                                        }

                                        // Hàm để populate dropdown
                                        function populateSelect(select, data, idKey, textKey) {
                                            // select.innerHTML = '<option value="">Chọn thành phố</option>';
                                            data.forEach(item => {
                                                var option = document.createElement('option');
                                                option.value = item[idKey];
                                                option.text = item[textKey];
                                                select.appendChild(option);
                                            });
                                        }
                                    });

                                </script>

                            </div>

                            <div class="form-group row">
                                <div class="col-md-12">
                                    <label for="c_address" class="text-black">
                                        <span class="text-danger">*</span>
                                        Địa chỉ cụ thể</label>
                                    <input type="text" class="form-control" id="c_address" name="diaChiCuThe"
                                           placeholder="Địa chỉ đường phố"/>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="c_order_notes" class="text-black">Ghi chú</label>
                                <textarea name="ghiChu" id="c_order_notes" cols="30" rows="5"
                                          class="form-control" placeholder="Viết ghi chú của bạn ở đây..."></textarea>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="row mb-5">
                        <div class="col-md-12">
                            <h2 class="h3 mb-3 text-black">Mã giảm giá</h2>
                            <div class="p-3 p-lg-5 border">
                                <div class="input-group w-75">
                                    <input type="text" class="form-control" id="c_code" placeholder="Coupon Code"
                                           aria-label="Coupon Code" aria-describedby="button-addon2"/>
                                    <div class="input-group-append" >
                                        <button class="btn btn-primary btn-sm" type="button"
                                                onclick="checkAndDisplayVouchers()"
                                                data-bs-toggle="modal" data-bs-target="#voucher">
                                            Chọn voucher
                                        </button>


                                        <!-- Modal -->
                                        <div class="modal fade" id="voucher" tabindex="-1"
                                             aria-labelledby="voucherLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h3 class="modal-title fs-5" style="margin: auto"
                                                            id="voucherLabel">Chọn Voucher
                                                        </h3>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="card mb-3" style="height: 10%"
                                                             th:each="voucher : ${listVoucher}">
                                                            <div class="row g-0">
                                                                <div class="col-md-3">
                                                                    <div class="card-body" style="margin-left: 5px;margin-top: 15px">
                                                                        <img src="../../static/img/logo.png" style="margin-left: 15px" class="img-fluid rounded-start" alt="...">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-7">
                                                                    <div class="card-body">
                                                                        <h5 class="card-title" style="margin-bottom: -3px" th:text="${'Giảm '+ voucher.phanTramGiam + '%'}"></h5>
                                                                        <small class="text-body-secondary"  style="display: block" th:text="${'Đơn Tối Thiểu '+voucher.giaTriDonToiThieu + ' VND'}"></small>
                                                                        <small class="text-body-secondary" style="display: block" th:text="${'Số Lượng '+voucher.soLuong}"></small>
                                                                        <small class="text-body-secondary" style="display: block" th:text="${'Hạn Sử Dụng '+voucher.ngayKetThuc}"></small>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="card-body">
                                                                        <input type="radio"  style="margin-top: 35px" name="voucherRadio" th:data-index="${voucher.id + ' ' +voucher.phanTramGiam}"
                                                                               onchange="handleRadioVoucher(this)">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <style>
                                                            .muted-radio {
                                                                opacity: 0.5; /* hoặc bất kỳ kiểu định dạng nào bạn muốn để làm mờ */
                                                                pointer-events: none; /* Ngăn chặn sự kiện click */
                                                            }
                                                            .muted-card {
                                                                opacity: 0.5; /* hoặc kiểu định dạng mờ khác */
                                                            }
                                                        </style>
                                                        <script>
                                                            function handleRadioVoucher(rowIndex) {
                                                                var index = rowIndex.getAttribute('data-index');
                                                                console.log(index)
                                                                // Tách chuỗi thành mảng các phần tử (số)
                                                                var numbersArray = index.split(' ');

                                                                // Chuyển đổi các phần tử thành số nguyên
                                                                var firstNumber = parseInt(numbersArray[0], 10);
                                                                var secondNumber = parseInt(numbersArray[1], 10);

                                                                // In ra kết quả
                                                                console.log('Số thứ nhất:', firstNumber);
                                                                console.log('Số thứ hai:', secondNumber);

                                                                var totalAmountAndSale = document.getElementById("totalAmountAndSale");
                                                                var moneyVoucher = document.getElementById("moneyVoucher");
                                                                var tongTienInt = parseInt(totalAmountAndSale.value);

                                                                moneyVoucher.innerText = tongTienInt + secondNumber


                                                            }
                                                            function checkAndDisplayVouchers() {
                                                                // Lấy giá trị totalAmount từ #totalAmount
                                                                var totalAmount = parseFloat(document.getElementById('totalAmount').innerText.replace(' VND', '').trim());
                                                                console.log(totalAmount)
                                                                // Lặp qua danh sách voucher và kiểm tra điều kiện
                                                                document.querySelectorAll('.card.mb-3').forEach(function(card) {
                                                                    var voucherGiaTriDonToiThieu = parseFloat(card.querySelector('.text-body-secondary').innerText.replace('Đơn Tối Thiểu ', '').replace(' VND', '').trim());
                                                                    var radio = card.querySelector('input[name="voucherRadio"]');

                                                                    // Nếu giá trị voucherGiaTriDonToiThieu nhỏ hơn totalAmount, làm mờ radio button
                                                                    if (voucherGiaTriDonToiThieu > totalAmount) {
                                                                        radio.classList.add('muted-radio');
                                                                        card.classList.add('muted-card');
                                                                        console.log(123)
                                                                    } else {
                                                                        radio.classList.remove('muted-radio');
                                                                        card.classList.remove('muted-card');
                                                                    }
                                                                });

                                                                // Hiển thị modal
                                                                $('#voucher').modal('show');
                                                            }

                                                        </script>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Quay lại
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-5">
                        <div class="col-md-12">
                            <div class="p-3 p-lg-5 border">
                                <table class="table site-block-order-table mb-5">
                                    <tbody>
                                    <tr>
                                        <td>Tổng tiền hàng</td>
                                        <td id="totalAmount" style="float: right">0 VND</td>
                                    </tr>
                                    <tr>
                                        <td>Phí vận chuyển</td>
                                        <td id="shippingFeeResult" style="float: right">0 VND</td>
                                    </tr>
                                    <tr>
                                        <td>Voucher</td>
                                        <td id="moneyVoucher" style="float: right">0 VND</td>
                                    </tr>
                                    <script>
                                        document.addEventListener("DOMContentLoaded", function () {
                                            tinhVaHienThiTongTien();
                                        });

                                        function tinhVaHienThiTongTien() {
                                            var table = document.getElementById("myTable");
                                            var total = 0;

                                            for (var i = 1; i < table.rows.length; i++) {
                                                var cell = table.rows[i].cells[5];
                                                var value = cell.innerHTML.replace(" VNĐ", "").trim();
                                                total += parseFloat(value);
                                            }

                                            var hiddenInputs = document.querySelectorAll('input[name="allIDGioHangCT"]');
                                            var allValues = [];
                                            for (var i = 0; i < hiddenInputs.length; i++) {
                                                allValues.push(hiddenInputs[i].value);
                                            }
                                            var idGioHangChiTiet = document.getElementById("idGioHangChiTiet");
                                            idGioHangChiTiet.value = allValues;

                                            var tongTien = document.getElementById("tongTien");
                                            tongTien.value = total;

                                            var tongTienAndSale = document.getElementById("tongTienAndSale");
                                            tongTienAndSale.value = total;

                                            // Hiển thị tổng tiền trên trang
                                            var totalElement = document.getElementById("totalAmount");
                                            totalElement.innerText = total + " VNĐ";

                                            // var sale = document.getElementById("sale");
                                            // giaGiam =  5/100;
                                            var tienShip = document.getElementById("shippingFeeResult");
                                            var soTienShip = parseInt(tienShip.innerText);

                                            var totalElementSale = document.getElementById("totalAmountAndSale");
                                            totalElementSale.innerText = total + " VNĐ";
                                        }
                                    </script>
                                    <tr>
                                        <td class="text-black font-weight-bold">
                                            <strong>Tổng thanh toán</strong>
                                        </td>
                                        <td class="text-black font-weight-bold">
                                            <strong id="totalAmountAndSale" style="float: right">0 VNĐ</strong>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>

                                <div class="form-group">
                                    <button class="btn btn-primary btn-lg py-3 btn-block" type="submit" form="form1">
                                        Đặt hàng
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- </form> -->
        </div>
    </div>

    <footer class="site-footer border-top">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <div class="row">
                        <div class="col-md-12">
                            <h3 class="footer-heading mb-4">Navigations</h3>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <ul class="list-unstyled">
                                <li><a href="#">Sell online</a></li>
                                <li><a href="#">Features</a></li>
                                <li><a href="#">Shopping cart</a></li>
                                <li><a href="#">Store builder</a></li>
                            </ul>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <ul class="list-unstyled">
                                <li><a href="#">Mobile commerce</a></li>
                                <li><a href="#">Dropshipping</a></li>
                                <li><a href="#">Website development</a></li>
                            </ul>
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <ul class="list-unstyled">
                                <li><a href="#">Point of sale</a></li>
                                <li><a href="#">Hardware</a></li>
                                <li><a href="#">Software</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
                    <h3 class="footer-heading mb-4">Promo</h3>
                    <a href="#" class="block-6">
                        <img src="../../static/img/hero_1.jpg" alt="Image placeholder"
                             class="img-fluid rounded mb-4"/>
                        <h3 class="font-weight-light mb-0">
                            Finding Your Perfect Shoes
                        </h3>
                        <p>Promo from nuary 15 &mdash; 25, 2019</p>
                    </a>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="block-5 mb-5">
                        <h3 class="footer-heading mb-4">Contact Info</h3>
                        <ul class="list-unstyled">
                            <li class="address">
                                203 Fake St. Mountain View, San Francisco, California, USA
                            </li>
                            <li class="phone">
                                <a href="tel://23923929210">+2 392 3929 210</a>
                            </li>
                            <li class="email">emailaddress@domain.com</li>
                        </ul>
                    </div>

                    <div class="block-7">
                        <form action="#" method="post">
                            <label for="email_subscribe" class="footer-heading">Subscribe</label>
                            <div class="form-group">
                                <input type="text" class="form-control py-4" id="email_subscribe"
                                       placeholder="Email"/>
                                <input type="submit" class="btn btn-sm btn-primary" value="Send"/>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="row pt-5 mt-5 text-center">
                <div class="col-md-12">
                    <p>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        Copyright &copy;


                        <script>
                            document.write(new Date().getFullYear());
                        </script>
                        All rights reserved | This template is made with
                        <i class="icon-heart" aria-hidden="true"></i> by
                        <a href="https://colorlib.com" target="_blank" class="text-primary">Colorlib</a>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </p>
                </div>
            </div>
        </div>
    </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
<script src="../../static/js/jquery-3.3.1.min.js"></script>
<script src="../../static/js/jquery-ui.js"></script>
<script src="../../static/js/popper.min.js"></script>
<script src="../../static/js/bootstrap.min.js"></script>
<script src="../../static/js/owl.carousel.min.js"></script>
<script src="../../static/js/jquery.magnific-popup.min.js"></script>
<script src="../../static/js/aos.js"></script>

<script src="../../static/js/main.js"></script>
</body>

</html>